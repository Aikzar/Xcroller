name: Release
on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  release:
    permissions:
      contents: write
    strategy:
      fail-fast: false
      matrix:
        platform: [windows-latest, ubuntu-22.04]
    runs-on: ${{ matrix.platform }}
    steps:
      - uses: actions/checkout@v4
      
      - name: setup node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: install Rust stable
        uses: dtolnay/rust-toolchain@stable
        
      - name: install dependencies (ubuntu only)
        if: matrix.platform == 'ubuntu-22.04'
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev libappindicator3-dev librsvg2-dev patchelf libxdo-dev libxcb-shape0-dev libxcb-xfixes0-dev
          
      - name: install frontend dependencies
        run: npm install
        
      - uses: tauri-apps/tauri-action@v0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tagName: app-v__VERSION__ 
          releaseName: 'Xcroller v__VERSION__'
          releaseBody: |
            ## Xcroller v0.2.0 - The Favorites & Quality of Life Update ‚ú®

            This major update transforms Xcroller into a fully-fledged media curator. We've introduced a robust Favorites system, advanced media handling, and significant UX polish.

            ### ‚≠ê Favorites & Curation
            - **Global Starring**: Toggle favorites from the main grid or the immersive viewer using the new Star icon or the `F` hotkey.
            - **Dedicated Favorites Feed**: Instantly access your curated collection via the new "Favorites" tab in the feed switcher.
            - **Export to Folder**: One-click export that copies all favorited media to a directory of your choice‚Äîperfect for organizing your best content.
            - **Clear All**: Reset your favorites with a single, safe confirmation dialog.

            ### üñºÔ∏è Enhanced Media Viewer
            - **Precision Zoom & Pan**: Deep-dive into high-resolution images. Features logic that follows your mouse movements for a fluid inspection experience.
            - **Smart Video Handling**: Persistent volume controls and an intuitive seek bar that stay out of the way during playback.
            - **Instant Metadata**: View file paths, dimensions, and types directly in the viewer overlay.

            ### üöÄ Navigation & Performance
            - **Recursive Scanning**: Now you can toggle recursion for folders, allowing you to index nested directories with one click.
            - **Advanced Sorting**: Added support for **Filename (Path) Sorting**, alongside existing date and size filters.
            - **Fluid Autoscroll**: Refined mouse-hover logic that smoothly pauses scrolling without jarring movements.
            - **High-Speed Indexing**: Optimized SQLite indices (idx_media_starred, idx_media_type) for lightning-fast feed switching.

            ### üîß UX/UI Improvements
            - **Escape Key Integration**: The `Esc` key now intelligently closes the media viewer AND exits application fullscreen mode in one go.
            - **Glassmorphism UI**: Refined toolbar and sidebar with improved blur effects and better visual hierarchy.
            - **Responsive Grid**: Grid column controls now range from 1 to 15, adapting to any screen size.

            ### üì¶ Assets
            Download the appropriate installer for your OS below. For Windows users, the `.msi` is the recommended path for a smooth installation.

            ---
            *Built with the power of Tauri & Rust. Experience your media like never before.*
          releaseDraft: false
          prerelease: false
